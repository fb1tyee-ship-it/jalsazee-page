<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Video Player</title>
<link rel="stylesheet" href="https://cdn.fluidplayer.com/v3/current/fluidplayer.min.css">
<script src="https://cdn.fluidplayer.com/v3/current/fluidplayer.min.js"></script>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#f7f7f7;display:flex;flex-direction:column;align-items:center}
header{
    background:#ff0000;
    color:white;
    padding:12px;
    text-align:center;
    font-size:20px;
    width:100%;
    position:sticky;
    top:0;
    display:flex;
    align-items:center;
    justify-content:center;
}
header button{
    position:absolute;
    left:10px;
    background:white;
    color:#ff0000;
    border:none;
    padding:6px 12px;
    font-size:14px;
    border-radius:6px;
    cursor:pointer;
    font-weight:bold;
}
header button:hover{background:#ffe5e5}
.player-container{display:flex;flex-direction:column;max-width:600px;width:100%;padding:10px}
video{width:100%;border-radius:10px}
#video-title{font-size:14px; margin:5px 0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
#video-desc{font-size:12px; color:#555; margin:2px 0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
</style>
</head>
<body>
<header>
  <button onclick="goBack()">⬅ Back</button>
  <span>Shajazada Bhai Videos</span>
</header>
<div class="player-container">
  <video id="video-player" controls></video>
  <h3 id="video-title" title=""></h3>
  <p id="video-desc" title=""></p>
</div>

<script>
function goBack(){ window.location.href = "index.html"; }

const vastTags = [
    "https://s.magsrv.com/v1/vast.php?idzone=5707142",
    "https://s.magsrv.com/v1/vast.php?idzone=5707152",
    "https://s.magsrv.com/v1/vast.php?idzone=5707156",
    "https://s.magsrv.com/v1/vast.php?idzone=5707158",
    "https://s.magsrv.com/v1/vast.php?idzone=5707162",
    "https://s.magsrv.com/v1/vast.php?idzone=5707164",
    "https://s.magsrv.com/v1/vast.php?idzone=5707166",
    "https://s.magsrv.com/v1/vast.php?idzone=5707168",
    "https://s.magsrv.com/v1/vast.php?idzone=5707170",
    "https://s.magsrv.com/v1/vast.php?idzone=5707172",
    "https://s.magsrv.com/v1/vast.php?idzone=5707174",
    "https://s.magsrv.com/v1/vast.php?idzone=5707176",
    "https://s.magsrv.com/v1/vast.php?idzone=5707178",
    "https://s.magsrv.com/v1/vast.php?idzone=5707180",
    "https://s.magsrv.com/v1/vast.php?idzone=5707182",
    "https://s.magsrv.com/v1/vast.php?idzone=5707184",
    "https://s.magsrv.com/v1/vast.php?idzone=5707186",
    "https://s.magsrv.com/v1/vast.php?idzone=5707188"
];

window.onload = function(){
    const params = new URLSearchParams(window.location.search);
    const url = params.get('url');
    const title = params.get('title');
    const desc = params.get('desc');
    const idx = parseInt(params.get('idx')) || 0;

    if(url){
        const player = document.getElementById('video-player');
        player.src = decodeURIComponent(url);
        document.getElementById('video-title').textContent = decodeURIComponent(title || '');
        document.getElementById('video-desc').textContent = decodeURIComponent(desc || '');
        document.getElementById('video-title').title = decodeURIComponent(title || '');
        document.getElementById('video-desc').title = decodeURIComponent(desc || '');
        player.load();

        // ১ মিনিট পরে mid-roll ads
        player.addEventListener('loadedmetadata', function() {
            const mainTime = 60; // 1 minute
            const vastTag = vastTags[idx] || vastTags[0];
            let adPlayed = false;

            const checkTime = setInterval(()=>{
                if(player.currentTime >= mainTime && !adPlayed){
                    adPlayed = true;
                    player.pause(); // pause main video
                    const fluid = fluidPlayer('video-player', {
                        vastOptions: {
                            adList: [{
                                roll: 'midRoll',
                                vastTag: vastTag,
                                timer: 0,
                                adText: 'Advertisement - Please wait',
                                adTextPosition: 'top left',
                                skipButtonCaption: 'Skip Ad',
                                skipButtonPosition: 'bottom right',
                                onAdComplete: function(){ 
                                    console.log("✅ Ad finished, resuming main video");
                                    player.play();
                                },
                                onAdSkip: function(){ 
                                    console.log("⚠️ Ad skipped, resuming main video");
                                    player.play();
                                }
                            }]
                        }
                    });
                    clearInterval(checkTime);
                    fluid.play();
                }
            }, 1000);
        });

        // autoplay safeguard
        const playPromise = player.play();
        if(playPromise !== undefined){
            playPromise.catch(error => {
                player.addEventListener('click', function(){ player.play(); }, { once: true });
            });
        }
    }
};
</script>

</body>
</html>
