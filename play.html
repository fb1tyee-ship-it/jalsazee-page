<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Video Player with VAST Ads</title>
<script src="https://imasdk.googleapis.com/js/sdkloader/ima3.js"></script>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#f7f7f7;display:flex;flex-direction:column;align-items:center}
header{background:#ff0000;color:white;padding:12px;text-align:center;font-size:20px;width:100%;position:sticky;top:0}
.player-container{max-width:600px;width:100%;padding:10px}
video{width:100%;border-radius:10px}
#video-title{font-size:14px; margin:5px 0;}
#video-desc{font-size:12px; color:#555;}
#adContainer{width:100%;height:300px;position:relative;background:black;display:flex;align-items:center;justify-content:center;color:white;font-size:16px}
</style>
</head>
<body>
<header>Shajazada Bhai Videos</header>
<div class="player-container">
  <div id="adContainer">Loading Ad...</div>
  <video id="contentElement" controls preload="none" style="display:none"></video>
  <h3 id="video-title"></h3>
  <p id="video-desc"></p>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const url = decodeURIComponent(params.get('url') || '');
const title = decodeURIComponent(params.get('title') || '');
const desc = decodeURIComponent(params.get('desc') || '');

document.getElementById("video-title").textContent = title;
document.getElementById("video-desc").textContent = desc;

const videoContent = document.getElementById('contentElement');
videoContent.src = url;

// --- VAST Ads List ---
const vastAds = ["https://s.magsrv.com/v1/vast.php?idzone=5707142", "https://s.magsrv.com/v1/vast.php?idzone=5707152", "https://s.magsrv.com/v1/vast.php?idzone=5707156", "https://s.magsrv.com/v1/vast.php?idzone=5707158", "https://s.magsrv.com/v1/vast.php?idzone=5707162", "https://s.magsrv.com/v1/vast.php?idzone=5707164", "https://s.magsrv.com/v1/vast.php?idzone=5707166", "https://s.magsrv.com/v1/vast.php?idzone=5707168", "https://s.magsrv.com/v1/vast.php?idzone=5707170", "https://s.magsrv.com/v1/vast.php?idzone=5707172", "https://s.magsrv.com/v1/vast.php?idzone=5707174", "https://s.magsrv.com/v1/vast.php?idzone=5707176", "https://s.magsrv.com/v1/vast.php?idzone=5707178", "https://s.magsrv.com/v1/vast.php?idzone=5707180", "https://s.magsrv.com/v1/vast.php?idzone=5707182", "https://s.magsrv.com/v1/vast.php?idzone=5707184", "https://s.magsrv.com/v1/vast.php?idzone=5707186", "https://s.magsrv.com/v1/vast.php?idzone=5707188"];

// প্রতিবার একেবারে unique random ad link বানানো
function getUniqueAd() {
   const base = vastAds[Math.floor(Math.random() * vastAds.length)];
   const unique = "&r=" + Math.random().toString(36).substring(2) + Date.now();
   return base + unique;
}

const adTagUrl = getUniqueAd();

// --- IMA SDK Setup ---
const adContainer = document.getElementById('adContainer');
const adDisplayContainer = new google.ima.AdDisplayContainer(adContainer, videoContent);
const adsLoader = new google.ima.AdsLoader(adDisplayContainer);

function initAdPlayback() {
  adDisplayContainer.initialize();
  const adsRequest = new google.ima.AdsRequest();
  adsRequest.adTagUrl = adTagUrl;
  adsRequest.linearAdSlotWidth = adContainer.offsetWidth;
  adsRequest.linearAdSlotHeight = 300;
  adsLoader.requestAds(adsRequest);
}

adsLoader.addEventListener(
  google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,
  function(event) {
    const adsManager = event.getAdsManager(videoContent);
    adsManager.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED, function() {
      adContainer.style.display = "none";
      videoContent.style.display = "block";
      videoContent.play();
    });
    try {
      adsManager.init(adContainer.offsetWidth, 300, google.ima.ViewMode.NORMAL);
      adsManager.start();
    } catch (adError) {
      console.log("Ad error:", adError);
      adContainer.style.display = "none";
      videoContent.style.display = "block";
      videoContent.play();
    }
  }
);

// Start Ad when page loads
window.onload = function() {
  initAdPlayback();
};
</script>
</body>
</html>
